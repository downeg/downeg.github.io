---
layout: default
title:  "Detection Engineering with SIEMs, Zui, Sigma and YARA"
date:   2023-11-10 09:00:00 +0000
categories: solarwinds malware university assignment
---

# Detection Engineering with SIEMs, Zui, Sigma and YARA.

---
University assignment Summer 2024

---

## Part 1. SIEM Discussion and Analysis.

> ## SIEM – Overview & Analysis.

#### SIEMS and Security.

{: style="text-align: justify" }
SIEM stands for Security Information and Event Management. It's a software solution that provides real-time analysis of security alerts generated by applications and network hardware. SIEM systems are designed to help organizations detect and respond to security threats more efficiently by centralizing log management, correlating events from various sources, and providing a comprehensive view of the organization's security posture.

{: style="text-align: justify" }
One of the primary benefits of SIEM for log monitoring is centralization. Instead of scattered logs across various systems and devices, a SIEM aggregates all logs into a central repository. Logs retrieved from many different sources can often have their own formatting and syntax. A SIEM provides the capability to normalise logs from disparate sources to a common standard. This makes searching and reporting on collated logs easier. When logs are stored in a central repository, they are easier to backup and archive for compliance requirements. The storing of logs in a central location also protects them from accidental or malicious modification or deletion on the source systems.

{: style="text-align: justify" }
SIEM systems provide an easy way to manage the monitoring of log data. By consolidating logs from multiple sources such as servers, firewalls, routers, applications, and endpoints, a SIEM provides a comprehensive view of an organization's IT environment. This enhanced visibility enables security teams to detect anomalies, track user activities, and identify potential security threats more effectively. Custom dashboards can be configured to provide Security Operations SOC with a "single pane of glass" view of the most important data being collected from the environment. SIEM systems offer real-time monitoring capabilities, continuously analysing incoming log data for suspicious activities or security incidents. When the SIEM detects an anomaly or a predefined security event, it generates alerts and notifications for security analysts to investigate promptly. This proactive approach to monitoring helps organizations identify and respond to security threats before they escalate.

{: style="text-align: justify" }
SIEM systems use advanced correlation techniques to link related events from different sources. By correlating events, the SIEM can identify patterns and sequences of activities that may indicate a security threat or an ongoing attack. This correlation and contextual analysis enhance the accuracy of threat detection, reducing false positives and improving the overall security posture.

{: style="text-align: justify" }
SIEM systems, while powerful for log monitoring, can also have some limitations. Due to the volume of data being processed, there may be a delay in the real-time alerting of complex attacks that span multiple sources. SIEMS may struggle to detect sophisticated and targeted attacks that use advanced evasion techniques or exploit zero-day vulnerabilities not yet documented in threat intelligence feeds. Additionally, SIEMs may generate too many false positives leading to alert fatigue, necessitating ongoing tuning and refinement to improve accuracy in threat detection.

{: style="text-align: justify" }
The benefits of a SIEM can vary significantly based on the size, complexity, and nature of an organization's IT environment. Simple IT environments with a few key systems would find value in basic SIEM functionalities like log aggregation, alerting, and compliance reporting, helping them maintain visibility and respond to common threats. Larger, more complex environments with diverse applications, cloud services, IoT devices, and hybrid architectures benefit from advanced SIEM features such as behaviour analytics, threat intelligence integration, automated response, and customizable correlation rules to detect and mitigate sophisticated threats.

{: style="text-align: justify" }
When assessing the effectiveness of a SIEM system, it's crucial to consider several key metrics and performance indicators. As an early warning system, one of the most critical KPIs is the false positive rate generated by the SIEM. Having a system that constantly triggers false incidents only adds to the workload of cybersecurity teams without real benefit. Tracking the percentage of alerts or events initially flagged as potential threats by the SIEM but later proven to be false positives is essential. A lower false positive rate signifies more precise threat detection and alleviates the workload for security analysts. Moreover, poorly defined SIEM rule sets can inundate analysts with numerous alerts daily, straining available resources for analysis. Refining rule sets significantly reduces this volume and allows teams to focus on authentic alerts more effectively.

{: style="text-align: justify" }
Another critical metric for evaluating the effectiveness of a SIEM is the Mean Time to Detection (MTTD) and Mean Time to Response (MTTR) [13, 14]. In large, complex environments characterized by the interdependency of threat detection on processing and analysing logs from diverse sources, timely detection and response are paramount. There's little value in receiving notifications of security events days after they've transpired. It's essential to assess the efficacy of rules and anomaly detection capabilities within the SIEM framework.

{: style="text-align: justify" }
Measuring Mean Time to Detection (MTTD) involves measuring the time elapsed from an event being logged to the generation of an alert. This duration signifies the system's responsiveness in identifying potential threats. Faster response times not only indicate efficient incident handling but also contribute significantly to mitigating security risks. Evaluating the Mean Time to Response (MTTR) involves measuring a Security Orchestration, Automation, and Response (SOAR) enabled SIEM's ability to promptly address and resolve security incidents once detected, reducing the impact and potential damage caused by threats.

{: style="text-align: justify" }
Analysing these metrics enables fine-tuning of rules, optimizing anomaly detection capabilities, and streamlining incident response processes, leading to enhanced functionality, faster threat detection, and more effective mitigation of security risks.

#### Distinguishing factors of a SIEM.

{: style="text-align: justify" }
There are several key capabilities that should be integrated into a SIEM if it is to effectively manage and monitor a production environment. Amongst these capabilities are; event correlation, threat intelligence, network transparency, regulatory compliance and Security Orchestration, Automation and Response (SOAR).

{: style="text-align: justify" }
SIEM systems excel at correlating events from multiple sources such as firewalls, intrusion detection systems, servers, and endpoints. This helps them detect sophisticated attack patterns that might not stand out when looking at one log at a time. Because of this, SIEMs can find threats faster and more accurately and can assist security teams with catching coordinated attacks or insider risks.

{: style="text-align: justify" }
SIEM systems can integrate internal data with third-party threat intelligence feeds on threats and vulnerabilities. The use of threat intelligence can provide the SIEM with real-time information about known malicious IP addresses, domains, malware signatures, and attack techniques. Using threat intelligence, SIEMs can enrich log data, prioritize alerts based on severity, and connect seemingly disparate events to known indicators of compromise. This integration enhances the SIEM's ability to detect and respond to emerging threats and targeted attacks.

{: style="text-align: justify" }
SIEM systems offer transparency into network health and activities, including analysis of NetFlow traffic flows, protocol usage, user behaviours, and application interactions. By analysing network logs and flow data, SIEMs can identify anomalous patterns, detect unauthorized access attempts, and pinpoint potential security breaches. Network transparency enables proactive threat hunting, anomaly detection, and rapid incident response to mitigate risks and protect critical assets.

{: style="text-align: justify" }
SIEM systems play a crucial role in processing extensive log data necessary for compliance with regulatory bodies and standards like HIPAA, PCI/DSS, HITECH, SOX, and GDPR. Serving as a centralized log repository, SIEMs facilitate effortless log archival, ensuring data integrity and providing comprehensive reporting capabilities. Furthermore, SIEMs capture security incidents, measure Mean Time to Detection (MTTD) and Mean Time to Response (MTTR), and track resolution times, all of which contribute to meeting compliance and security regulations effectively.

{: style="text-align: justify" }
SIEM systems can act as Security Orchestration, Automation, and Response (SOAR) platforms, integrating security tools and automating incident response processes. They enable orchestration of security workflows, automate repetitive tasks, and streamline incident handling, enhancing operational efficiency and response times.

{: style="text-align: justify" }
A typical log management system may serve as a central repository for collecting, storing, and viewing log data, but it lacks advanced functionalities like event correlation across diverse sources, integration with threat intelligence feeds, and comprehensive reporting required for regulatory compliance. On the other hand, IDP and IPS solutions prioritize real-time event detection but lack the archival and reporting capabilities of a SIEM. While IDS/IPS systems focus on monitoring and protecting network traffic at specific segments, they offer a more limited scope compared to SIEMs, particularly in terms of compliance-focused features such as log analysis, correlation, and tailored reporting for regulatory frameworks.

{: style="text-align: justify" }
Log sources should cover all aspects of the IT infrastructure. This includes network devices like routers, switches, next-generation firewalls, and IDS/IPS systems, all of which should send their log data to the SIEM. Operating system logs from servers and client endpoints, as well as logs from dedicated applications such as web servers, databases, and critical business systems, should also be monitored. Additionally, logs from antivirus software, Endpoint Detection and Response (EDR) technologies, interactive login services like Active Directory or LDAP, IoT devices, SCADA systems, and cloud services (e.g., AWS, Azure) hosting business applications, should be gathered by the SIEM for comprehensive visibility and security monitoring.

{: style="text-align: justify" }
Given the diverse array of sources, it's common for logs to vary significantly in format and syntax. By employing parsing rules to extract crucial information like timestamps, source IP addresses, event types, usernames, and actions from raw log data, a SIEM can standardize its data pool. This allows for normalized and relevant charts and reports, enriched with geolocation data from IP addresses, threat intelligence indicators, asset details, and user attributes, thereby enhancing analysis and correlation capabilities. Normalizing log data to a common format or schema ensures consistent data representation and facilitates correlation based on shared attributes.

#### Evaluate the different types of SIEM systems available in the market, including open-source and commercial solutions.

{: style="text-align: justify" }
A SIEM's costing model can be divided into two key areas: Capital Expenditure (CapEx) and Operational Expenditure (OpEx). CapEx includes software licenses, rule development, integration, SOC staff training, hardware, storage costs, and log archival. OpEx encompasses SOC staffing, cloud-based resources, and ongoing SIEM maintenance.

{: style="text-align: justify" }
Open Source SIEM tools like Wazuh and OSSIM may not require upfront license fees, but the expenses of customized configuration, rule development, and ongoing upkeep could outweigh these savings. They may also lack advanced features, suitable mainly for small business setups. Some SIEM providers offer free versions with outdated rule sets, keeping the most up to date threat intelligence information for paid subscribers.

{: style="text-align: justify" }
Commercial SIEM versions can offer various pricing models. For example, Splunk provides Workload pricing (based on Splunk Virtual Compute units for better data parsing), Entity pricing (based on managed hosts/devices) and Ingest pricing (based on data volume). Evaluating these models is crucial to find a SIEM solution that fits both the environment's size and budget.

{: style="text-align: justify" }
The allowed budget for SIEM solutions should align with the scale and complexity of the environment being monitored. Tailoring the pricing model to factors such as data volume, number of devices, workload intensity, and desired features helps optimize cost-effectiveness and resource allocation for effective security monitoring.

#### What is SOAR and UEBA?

{: style="text-align: justify" }
SOAR (Security Orchestration, Automation, and Response) and UEBA (User and Entity Behaviour Analytics) are vital components of next-generation SIEMs. SOAR platforms expedite incident response by automating repetitive tasks, coordinating security workflows, and seamlessly integrating with diverse security tools for efficient threat mitigation. SOAR platforms ingest alert data, which subsequently triggers playbooks automating and orchestrating response workflows or tasks. This enables SOC teams to promptly engage in incident response, swiftly and accurately identifying the threat level and assigning priority to event alerts.

{: style="text-align: justify" }
UEBA focuses on analysing user behaviour and entity activities to detect anomalies, insider threats, and advanced attacks that escape traditional detection methods. It achieves this using algorithms and machine learning to identify any activities or behaviour outside the established baseline. UEBA systems not only detect sophisticated attacks faster than human analysts but also decrease the overall cost of operating a SOC by allowing analysts who previously monitored anomalies to concentrate on more critical SOC tasks.

{: style="text-align: justify" }
AI algorithms excel at pattern recognition. A machine learning model can analyse historical data, security incidents, and threat trends to establish a baseline for normal user, network, and system activity within an organization's IT infrastructure. Using this baseline, AI can detect subtle pattern changes in user activities. It can swiftly identify complex attack patterns, reconnaissance activities, lateral movement within networks, and multi-stage attack sequences that may span multiple log sources. With predefined automated responses, AI can expedite incident response by isolating compromised systems, blocking malicious IP addresses, and containing security incidents before they escalate.

> ## SIEM – Implementation

{: style="text-align: justify" }
When considering infrastructure costs, it's crucial to weigh both Capital Expenditure (CapEx) and Operational Expenditure (OpEx) aspects. Determine whether building an in-house solution, requiring initial CapEx investment in server compute power and storage arrays for log archival, is more cost-effective. Alternatively, a cloud-based or hybrid solution, treated as an OpEx, might offer better affordability. Ensure the network can handle increased bandwidth demands for transferring logs to data collection points.

{: style="text-align: justify" }
Regarding staffing, decide if new hires dedicated to SIEM monitoring are needed or if the responsibility falls on an existing SOC team, considering potential disruptions to their current tasks. Check if the SIEM vendor provides specialized training for staff, whether free or paid, or explore third-party training options, especially for open-source solutions.

{: style="text-align: justify" }
Assess the proposed SIEM's compatibility with existing security tools like firewalls, IDS/IPS, EDR, and threat intelligence platforms. Look for providers offering seamless integration and data sharing with other security technologies already in use.

{: style="text-align: justify" }
For compliance, verify that the SIEM aligns with regulatory requirements and industry standards relevant to the organization (e.g., GDPR, PCI/DSS, HIPAA). Select a SIEM capable of generating compliance reports, audit trails, security dashboards, and executive summaries for stakeholders, auditors, and regulatory bodies.

{: style="text-align: justify" }
Lastly, ensure the SIEM solution can scale alongside the organization's growth. If starting with a limited rollout to critical applications, confirm the SIEM can be upgraded and expanded to handle increased log volume and analysis as the organization expands its monitoring scope.

#### What are the most important considerations when designing a SIEM system, such as log source selection, data storage and retention policies, and alerting and reporting mechanisms. 

{: style="text-align: justify" }
Identify and prioritize log sources based on their relevance to security monitoring and potential threats to the organization. This includes logs from network devices (firewalls, routers, switches), servers (operating systems, applications, databases), endpoints (workstations, laptops, mobile devices), security devices (IDS/IPS, antivirus, EDR), authentication systems (Active Directory, LDAP), cloud services, and critical applications. Ensure comprehensive coverage of log sources to detect and respond effectively to a broad spectrum of security incidents.

{: style="text-align: justify" }
Consider the storage type required and adhere to organization and regulatory retention policies. While processing and analysing log data (hot data), store it on fast media in an uncompressed state to avoid performance bottlenecks that could delay real-time processing and alerting. For compliance-driven archiving, transition cold data to compressed storage on slower disk media or move it to secure, cost-effective cloud storage. Plan for long-term retention with a focus on data retrieval capability for investigations, accounting for the associated cost and retrieval time.

{: style="text-align: justify" }
When designing the SIEM project, focus on developing effective alerting and reporting mechanisms to promptly notify SOC analysts and stakeholders about security incidents, anomalies, and policy violations. Configure alert thresholds and escalation procedures based on threat intelligence, risk assessments, and organizational priorities. Customize report templates to suit the target audience, including executive-level overviews, detailed compliance reports, and the technical information required for digital forensics.

#### What is the difference between agent based and agentless approaches? 

{: style="text-align: justify" }
The difference between agent-based and agentless approaches lies in how they collect and transmit data in a system or network.

{: style="text-align: justify" }
An agent-based approach to log collection involves deploying software agents or lightweight programs on individual devices, such as servers, workstations, and endpoints. These agents continuously gather and monitor data locally, including log files, system metrics, network activity, and security events. The central SIEM system acts as a client and can request data from these agents as needed. Agents can be managed and updated centrally through the SIEM management interface. In environments with limited network bandwidth, agents can parse log data locally and transmit only relevant data to the SIEM solution, potentially improving performance. Additionally, agents enable more detailed and specialized scanning of components and services.

{: style="text-align: justify" }
On the other hand, agentless systems operate on a push communication style. They do not require dedicated software agents installed on devices but instead rely on existing protocols and interfaces like SNMP, WMI, REST, and other APIs to remotely collect data. Using network-based scanning and querying techniques, agentless SIEM systems retrieve information such as system logs, configuration settings, performance metrics, and network traffic. While agentless solutions are easier to deploy and scale, they may have limitations in terms of data granularity, real-time monitoring, and support for specific devices or applications compared to agent-based solutions.

#### What are the challenges and opportunities associated with integrating a SIEM with different types of IT environments, including on-premises, cloud based, and hybrid environments?

{: style="text-align: justify" }
On-premises SIEM solutions provide organizations with complete ownership and control over their data. By storing and processing all log data in-house, on-premises solutions ensure data isolation from third parties, which may be required for compliance requirements. Additionally, local data availability enables low-latency access for processing and analysis, mitigating WAN-based network bottlenecks.

{: style="text-align: justify" }
However, the initial cost of purchasing storage and computing power for an on-premises SIEM can be a challenge. Nevertheless, this upfront investment can be seen positively, considering that the costs of cloud-based solutions might exceed the initially budgeted amount.

{: style="text-align: justify" }
Cloud-based solutions offer several advantages, including low initial implementation costs and rapid deployment due to the availability of turnkey solutions from cloud vendors. Scalability is another benefit, as cloud infrastructure allows for flexible scaling of storage and computing resources based on changing needs, eliminating the lead time required for acquiring and installing new hardware in an on-premises setup.

{: style="text-align: justify" }
Integrating with cloud services may pose challenges, particularly when the required data for the SIEM (e.g., packet analysis) is not readily available from the cloud provider. Managing multiple cloud vendors necessitates understanding their proprietary APIs and data formats, which adds complexity compared to traditional on-premises integrations.

{: style="text-align: justify" }
Data sovereignty regulations also play a role with cloud services, dictating where specific data can be stored and how it should be handled. For instance, GDPR mandates data to be kept in the region of origin.

{: style="text-align: justify" }
A hybrid model can leverage the benefits of both on-premises and cloud-based solutions. It strikes a balance by utilizing on-premises storage and computing power for real-time analysis while storing less frequently accessed data in cost-effective cloud storage. This approach allows organizations to handle real-time processing in-house while offloading historical analysis and reporting tasks to cloud platforms.

#### How can a SIEM be integrated with other security technologies such as firewalls, intrusion prevention systems, and endpoint detection and response tools to provide a comprehensive security posture for an organization? Are there any challenges associated with these integrations?

{: style="text-align: justify" }
SIEMs can integrate with firewalls and IDS systems to gather logs and events pertaining to network traffic, firewall rule modifications, and security incidents. Additionally, data retrieved from EDR solutions encompasses operating system and software patch versions, specific logs, runtime information (e.g., SNMP, WMI), software installations that deviate from user acceptance policies, and authentication failures.

{: style="text-align: justify" }
By consolidating and collecting logs from diverse sources within the environment, this integration facilitates the correlation of firewall events with system logs, network activities, and recurring authentication issues. However, challenges may arise, including the need to parse logs from various vendors, ensure uniform data formats, and manage a substantial volume of log events. Without proper filtration or prioritization, this influx of data could overwhelm the SIEM and lead to a surge in false-positive alerts.

#### How are the following items important to SIEM implementation?

{: style="text-align: justify" }
* ***Data Ownership:*** Data ownership is critical in SIEM solutions as it determines accountability for the security and privacy of sensitive and personally identifiable information (PII). Clear data ownership policies ensure that the right individuals or teams are responsible for managing, protecting, and analysing security data, helping to maintain data integrity and compliance. SIEM systems can be used to detect the storage and transmission of PII to ensure compliance standards are being met.

{: style="text-align: justify" }
* ***Log Sources:*** Effective log sources are essential components of a SIEM system, as they provide insight into system activities, user behaviour, and security events throughout the IT infrastructure. The breadth and depth of log sources significantly influence the SIEM's capacity to detect threats, conduct correlation analysis, and derive actionable intelligence for incident response.

{: style="text-align: justify" }
* ***Log Processing:*** Log processing serves as the fundamental operation of a SIEM, converting raw log data into organized and actionable insights, facilitating streamlined threat detection and incident handling. Successful log processing incorporates parsing, normalization, and enrichment methods, amplifying the SIEM's capacity to link events, recognize trends, and extract valuable insights from extensive log datasets.

{: style="text-align: justify" }
* ***Threat Assessment:*** Assessing threats in a SIEM system entails gauging the severity, impact, and potential risk of identified threats, allowing for prioritized incident response and resource allocation. Through comprehensive threat assessments, SIEM systems can pinpoint and prioritize high-risk threats, resulting in enhanced threat mitigation and a strengthened security stance.

{: style="text-align: justify" }
* ***Rule integration:*** Rule integration is a requirement for a SIEM as it allows for the implementation of specific criteria and conditions that dictate how security events are analysed, categorized, and responded to. Effective rule integration enables the SIEM to automate threat detection, streamline incident handling processes, and adapt to evolving security threats and trends.

> ## SIEM – Threat Hunting

#### What is threat hunting?

{: style="text-align: justify" }
Threat hunting is a proactive and strategic approach to identifying and mitigating potential security threats before they escalate into full-blown attacks. Unlike traditional cybersecurity measures that mainly focus on defence mechanisms and reactive incident response, threat hunting delves deeper into the network to actively seek out signs of malicious activities, stealthy threats, and advanced persistent threats (APTs) that might evade traditional security controls. This process entails a systematic and continuous search for anomalies, suspicious patterns, and indicators of compromise (IoC) within an organization's IT environment. Threat hunting leverages advanced tools like SIEM systems to detect, investigate, and neutralize threats that may exist undetected in the network. SIEM systems are particularly well-suited to contribute their anomaly detection and pattern recognition capabilities to threat hunting efforts. The aggregated log data gathered from the network's hardware and software infrastructure can aid in creating hypotheses about potential adversary pathways into the network, followed by a thorough search for IoC that could signal an impending attack. By being proactive and scanning for undetected threats, threat hunting goes to the next level, digging deep to find anything malicious that may put login credentials, confidential information and other data at risk.

#### How can organizations develop and implement a proactive threat hunting program that leverages the capabilities of a SIEM to identify and mitigate security threats before they cause damage?

{: style="text-align: justify" }
The first step in implementing a threat hunting program is to define the scope and objectives of the project. Define what assets are to be protected by the program and then develop hypothesis statements about what threats those assets might be vulnerable to. A SIEM can then be used to manage the collection, aggregation, parsing and normalisation of all logs related to the asset being protected. Once the log data is aggregated, the threat hunter selects a trigger for further investigation. Triggers can vary and may include specific systems, network segments, or hypotheses triggered by various factors such as announced vulnerabilities, zero-day exploits, anomalies within security datasets, or requests from other areas within the organization. Upon identifying a trigger, the focus of threat hunting efforts shifts to proactively searching for anomalies that either validate or refute the initial hypothesis. This proactive approach aligns with the "we are already compromised" strategy, and SIEM systems play a crucial role in reviewing logs and investigating anomalies during this phase. During the investigation phase, threat hunting playbooks and procedures are utilized to outline the necessary steps for improvement in future projects. Once the investigation concludes, the findings are reported back to SOC analysts, IT teams, and management. These insights, along with recommendations, can then be utilized to refine SIEM alerting rules, thereby enhancing the future detection of potential attacks.

#### What are the key log analysis techniques and tools used for threat hunting in a SIEM system, such as pattern recognition, correlation analysis, and behavioural profiling?

{: style="text-align: justify" }
Key log analysis techniques and tools utilized for threat hunting in a SIEM system include pattern recognition, which leverages machine learning algorithms and statistical analysis to discern patterns and trends within log data. Patterns can range from simple anomalies to complex attack signatures, allowing threat hunters to detect irregularities that may indicate potential security threats. The SIEM's capacity to aggregate log data from diverse sources enables threat hunters to identify connections and interdependencies among various events. By correlating events across network devices, servers, endpoints, and applications, threat hunters can unveil suspicious activities that might elude detection when examining individual logs in isolation. Additionally, behavioural profiling plays a pivotal role in detecting any deviance from the typical behaviour of users, devices or network asset. Behavioural profiling establishes a baseline of normal behaviour and can be executed through a UEBA-enabled SIEM. By zeroing in on these anomalies, security teams can gain visibility and identify unexpected behavioural tactics of attackers early on, before they fully execute their plan of attack. Furthermore, a SIEM's integrated visualization techniques, dashboards, and graphical representations facilitate the presentation of log data in a coherent and actionable format, enabling threat hunters to discern trends, anomalies, and patterns more effectively. This capability enhances the overall threat hunting process by providing a clear and concise view of the security landscape, aiding in swift decision-making and response actions.

#### How can organizations leverage threat intelligence (the need for Sigma & YARA Rules) and other external data sources to enhance their log analysis and threat hunting capabilities in a SIEM system?

{: style="text-align: justify" }
Sigma and YARA rules are two powerful tools for detecting and hunting malware threats. SIGMA rules, an open rule language introduced in 2017 by Florian Roth and Thomas Patzke, provide a platform-agnostic approach to describing malicious activities, freeing defenders from vendor-specific detection languages and repositories. By harnessing the collective expertise of the community, SIGMA enables timely responses to critical threats and evolving adversary tactics. YARA is an open-source pattern-matching tool designed to detect and classify malicious software. YARA rules, comprising a set of instructions defining the characteristics of specific malware types, are instrumental in threat detection. Integrating Sigma and YARA rules into a SIEM system empowers organizations to utilize pre-built rulesets crafted by security experts and threat intelligence providers. These rulesets can identify known attack patterns, indicators of compromise (IoC), and malicious behaviours, thereby enhancing the SIEM's capability to detect and counter security threats effectively.

{: style="text-align: justify" }
Subscribing to reputable threat intelligence feeds provides organizations with real-time information on emerging threats, known attack techniques, malicious IP addresses, and domain names associated with malicious activities. By integrating these feeds into the SIEM, organizations can automatically enrich log data with contextual information such as threat scores, classifications, and mitigation recommendations. This enrichment significantly improves threat detection accuracy and enables security teams to prioritize and respond promptly to high-risk threats.

{: style="text-align: justify" }
Additionally, engaging with Information Sharing and Analysis Centres (ISACs) and Information Sharing and Analysis Organizations (ISAOs) grants organizations access to collective threat intelligence shared by industry peers and security experts. ISACs serve as vital resources for gathering information on cyber threats, facilitating two-way information sharing between the private and public sectors on root causes, incidents, and threats. This collaborative approach enhances the overall cybersecurity posture by leveraging shared experience, knowledge, and analysis.

#### What are the key challenges and limitations of using log data for threat hunting in a SIEM system, such as data quality issues, false positives, and incomplete or missing data?

{: style="text-align: justify" }
When aggregating logs from various sources within an IT environment, one of the foremost challenges arises from the disparate quality of the log data provided by each device. This variance can range from devices logging minimal data to conserve storage space to others inundating the system with verbose debug logs. The inconsistency in log format across different sources further complicates the process, as it hampers the accurate normalization and correlation of events. For instance, a misconfigured agent in an agent-based logging solution might fail to collect comprehensive data crucial for conducting thorough threat hunting activities. 

{: style="text-align: justify" }
Moreover, it's essential to consider the timeliness of log data for effective threat hunting. Engaging in threat hunting using outdated logs from systems that have undergone upgrades or patching can lead to false positives, undermining the validity of the findings and consuming valuable time and resources. Therefore, organizations must prioritize real-time or near-real-time log collection to ensure the relevance and accuracy of data for threat detection and analysis during threat hunting engagements.


> ## Example Organisation – Case Study

#### Identify the organization's security needs, compliance requirements, and budget constraints.

{: style="text-align: justify" }
ABC Corp faces several critical IT security needs, each tied to specific compliance requirements and budget constraints. Firstly, safeguarding the OT/Production network is vital to prevent unauthorized changes that could jeopardize human safety and product quality. This includes implementing robust access controls, intrusion detection systems, and monitoring mechanisms such as Supervisory Control and Data Acquisition (SCADA) to detect and respond swiftly to any anomalies or potential threats in the operational technology environment.

{: style="text-align: justify" }
For the e-commerce platform, compliance with GDPR regulations is imperative to ensure the secure storage and processing of customer Personally Identifiable Information (PII). This involves implementing encryption protocols, access controls, data masking, and regular audits to maintain GDPR compliance and protect sensitive customer data from unauthorized access or breaches. Furthermore, any storage or processing of credit card information must adhere strictly to the Payment Card Industry Data Security Standard (PCI DSS) requirements mandated by major credit card brands. This necessitates implementing secure payment gateways, tokenization, encryption of cardholder data, and regular security assessments to maintain PCI DSS compliance and protect financial data from cyber threats. The protection of employee PII on HR devices is another crucial aspect, requiring measures such as access controls, encryption, secure data storage, and employee awareness training to prevent data breaches or unauthorized access to sensitive HR information.

{: style="text-align: justify" }
Safeguarding company intellectual property (IP) is paramount to prevent theft by threat actors and insider threats. This entails implementing data loss prevention (DLP) solutions, access controls, encryption of sensitive IP, monitoring for unusual activities, and conducting regular security audits to protect valuable research, patents, and proprietary information from unauthorized access or exfiltration.

{: style="text-align: justify" }
Given ABC Corp's budget constraints, it's crucial to prioritize these IT security needs by assessing risks, meeting regulatory compliance, and addressing critical business operations. This includes optimizing resource allocation, utilizing cost-effective security solutions, and consistently enhancing security measures within the budgetary confines. Attention should also be given to the expenses associated with storing and archiving log data for trend analysis and compliance purposes. Cloud storage offers a cost-effective solution for long-term storage of cold data that does not require immediate processing and is primarily retained for financial regulatory compliance.

#### Analyse what log data should be collected, from where and how (agent or agentless)?

{: style="text-align: justify" }
In the perimeter devices, agent-based data collection may not be possible based on device types. When agent-based collection isn't feasible, it's crucial to maximize log data transmission via syslog to our SIEM central collector from these devices. Specifically, activities like logins, configuration changes, modifications to rules and audit files should be logged and sent from both the firewall and IDS to the SIEM central collector. Additionally, any alerts generated by the firewall and IDS must be forwarded to the SIEM collector through available channels such as SNMP traps or syslog. The successful establishment of VPN connections and associated accounts, along with failed VPN authentication attempts, should also be logged and sent to the collector. Furthermore, tracking configuration changes and identifying the account responsible for the change on the router and VPN gateway are essential logging practices for enhanced security.

{: style="text-align: justify" }
Within the Demilitarized Zone (DMZ), deploying agent-based data collection on the webserver, database server, and email server is imperative. This ensures that the SIEM collector receives up-to-date information for real-time event analysis. Specifically, the webserver logs should capture comprehensive details like client IP addresses, user agents, requested resources, and forwarding URLs. Additionally, all servers in the DMZ should have EDR and antivirus software installed and must send log and scan data to the SIEM central collector. Anti-phishing software on the email server should also transmit alerts and log data to the collector. If agent-based installation is not possible on the router, configuring it to transmit agentless audit and configuration/rule change data to the SIEM collector becomes essential.

{: style="text-align: justify" }
Given that ABC Corp utilizes these servers for e-commerce activities, thorough scanning of all data received from the DMZ for personally identifiable information (PII) is vital. Any identified PII should either be removed or anonymized in the stored log data to comply with GDPR requirements. Log retention settings for these e-commerce systems should align with PCI/DSS and other regulatory requirements applicable to the region.

{: style="text-align: justify" }
In the internal network, configuring every firewall and IDS to transmit log and audit data to the collector via syslog becomes crucial if agent-based installation isn't possible. These syslog transmissions should encompass audit logs related to logins and configuration/rules modifications. Additionally, all alerts triggered by these devices should be routed to the SIEM collector through SNMP Traps, syslog, or other available methods. Audit logs for logins, both successful and unsuccessful, along with any modifications to configuration or routing tables, should also be sent from routers within the internal network.

{: style="text-align: justify" }
Considering the likelihood of IoT devices in the OT/Production network not allowing agent-based installations, they should be configured to transmit as much log data as possible to the central SIEM collector. This includes audit logs detailing successful and unsuccessful login attempts to these devices. Similarly, Supervisory Control and Data Acquisition (SCADA) systems in the OT/Production network must be configured to forward their log and monitoring data to the central SIEM collector for comprehensive threat monitoring and analysis.

{: style="text-align: justify" }
The end user network and security/IT network should deploy antivirus and EDR solutions on all devices. Log data from these solutions, along with event and audit logs from the operating system and all application logs, must be transmitted back to the SIEM collector.

{: style="text-align: justify" }
Within the database server network segment, all database servers should be equipped with agent-based collection for antivirus and EDR software, as well as logging of OS and login audit data to be sent to the SIEM collector. However, logging every database transaction to the SIEM may overwhelm the system due to the sheer volume of transactions monitored. Therefore, it's crucial to strike a balance by selecting which databases have their queries logged for PCI/DSS compliance and real-time detection of behavioural changes and anomalies in queried tables. Additionally, all log data resulting from database queries should undergo scanning for personally identifiable information (PII), with any identified PII being either removed or anonymized before logs are archived to ensure compliance with GDPR fair data processing standards.

#### Propose a SIEM solution that best aligns with the organization's requirements.

{: style="text-align: justify" }
***Describe the chosen SIEM system in detail, for example Splunk: (a) what functions should it have, (b) what are the associated best practises and (c) what are the main steps in implementing your chosen SIEM in the example organization.***

{: style="text-align: justify" }
Splunk, which was acquired by Cisco on March 18th, 2024, offers Splunk Enterprise Security (SES), a comprehensive data analytics and monitoring solution designed to empower organizations in detecting, investigating, and responding to cybersecurity threats effectively. The primary function of Splunk ES is to aggregate and correlate security-related data from diverse sources across an organization's IT infrastructure, including network devices, servers, endpoints, security appliances, applications, and cloud services. This data is then analysed in real time using cutting-edge analytics, machine learning, and behavioural analytics techniques to identify anomalies, suspicious activities, and potential security threats.

{: style="text-align: justify" }
Splunk ES offers both agent-based and agentless data collection methods. Agentless data collection leverages protocols like syslog, ICMP, SNMP, and WMI and is suitable for devices where installing an agent is not feasible. However, some of these protocols may lack data encryption during transit. To address this, the Splunk Forwarder Agent (which uses SSL for encryption of data in transit) can be installed on systems, devices, and endpoints that support it. Splunk ES is versatile in accepting logs in various formats and conducts data normalization to ensure a standardized data format throughout the environment. This standardization of log data facilitates easier analysis of system performance and data usage trends across the entire environment.

{: style="text-align: justify" }
Once the servers for the Splunk installation itself are set up, the primary challenge with deployment at ABC Corp will be determining the rollout procedure. The initial focus should be on integrating the most critical and vulnerable systems, such as the perimeter devices and those in the DMZ. Integration should be scheduled to minimize business impact, ensuring that any necessary downtime for reboots after agent installation is planned effectively.

#### Justify your recommendation based on the features, scalability, cost-effectiveness, and support options offered by the SIEM solution.

{: style="text-align: justify" }
Splunk offers various pricing models, such as workload pricing, ingest pricing, entity pricing, and activity-based pricing. Workload pricing is based on the compute and storage resources necessary for running workloads, while ingest pricing depends on the amount of data (measured in gigabytes) ingested into Splunk products daily. ABC Corp, despite monitoring numerous devices like firewalls, network devices, servers, and endpoints, doesn't generate a massive volume of log data each day. Hence, the ingest pricing model is suitable for their environment, enabling extensive processing, trend analysis, and historical data analytics. As a paying customer of Splunk ES, Splunk Customer Support is available through the support portal or by telephone.

# Part 2: Attack Identifiers and Rules

> ## Identify specific indicators of compromise and/or identifying attributes for each of the 3 attacks you discussed that can be used with signature-based detection strategies.

{: style="text-align: justify" }
The first OWASP Top Ten Vulnerability chosen for Assignment 1 was ```A01:2021 - Broken Access Control```, focusing specifically on ```Insecure Direct Object Reference (IDOR)``` attacks. In an IDOR attack, a threat actor manipulates object references within the application to gain unauthorized access to resources. For example, altering a user ID within a web URL could allow viewing information about different users if proper authentication mechanisms were not in place to prevent this. The key indicator of such an attack in the logs was the occurrence of repeated HTTP 404 response errors associated with a specific path, for example the ```profile``` URL. In Linux environments, these webserver logs would be found in the Apache access log located at ```/var/log/apache2/access.log```. For Microsoft IIS webservers, the log files would reside in the ```C:\inetpub\logs\LogFiles\``` directory.

IMAGE MISSING
Example of attempted IDOR in Apache access.log file.

{: style="text-align: justify" }
The second OWASP Top Ten Vulnerability chosen was ```A03:2021 - Injection```, with a focus on ```Cross-Site Scripting (XSS)```. In this attack scenario, threat actors inject malicious scripts or payloads into the URL or into user-controlled input fields of webpages, intending for these malicious scripts to execute on a victim's browser. This exploit is successful when web applications lack sufficient input validation and sanitization mechanisms. To identify this type of attack, one can search for specific keywords such as ```<script>```, ```<img>```, and ```<iframe>``` within URLs, as these elements would not typically be part of a valid URL structure. For Apache Linux webservers, the relevant source logs for checking URLs are located in ```/var/log/apache2/access.log```, while for Microsoft IIS webservers, these logs are written into the ```C:\inetpub\logs\LogFiles\ directory```.

{: style="text-align: justify" }
The third OWASP Top Ten Vulnerability chosen was ```A10:2021 - Server-Side Request Forgery (SSRF)```. This web application vulnerability allows threat actors to manipulate outgoing requests from a web server, potentially leading to unauthorized access to internal systems or sensitive data. In SSRF attacks, an identifying attribute is the presence of internal server IP addresses or hostnames within the URL. This indicates attempts to target internal resources. For detection, the webserver access logs can be monitored for occurrences of internal IP addresses in requested URLs. In Apache Linux webservers, relevant logs are located at ```/var/log/apache2/access.log```, while for Microsoft IIS webservers, the logs are found at ```C:\inetpub\logs\LogFiles\```.

IMAGE MISSING
Example of internal hostnames in the URL during an SSRF attack.

> ## Discuss how the attack indicator analysis can be used with Sigma and YARA approaches to improve attack detection and how they are implemented in a SIEM architecture.

{: style="text-align: justify" }
The Sigma rule format serves as a standardized method for security professionals to share detections of malicious or dangerous behaviour. It offers a flexible descriptive language designed for writing abstract vendor-agnostic rules that detail specific indicators of compromise (IoC) found within logs. Given the varying formats and syntax used by different SIEM vendors for search queries and alert definitions (e.g., Splunk Search Processing Language), Sigma was developed as an open-source standard. This allows a single Sigma detection rule to be utilized across various SIEM platforms, promoting consistency and interoperability in the cybersecurity landscape. By encapsulating an IoC within a Sigma rule, it can be easily shared within the cybersecurity community and translated into different SIEM languages using encoding tools by interested parties.

{: style="text-align: justify" }
YARA is a tool used to identify and categorize malware by analysing patterns and distinct characteristics. YARA rules are crafted in a specific syntax, allowing security analysts to outline patterns, strings, and conditions indicative of malware presence. Typically, rules are structured into two main sections: the strings definition and the condition. The strings definition encompasses the parameters to be scanned for within a log file, i.e., the IoC present in the log file, while the condition section comprises a Boolean expression telling under which circumstances a file or process satisfies the rule or not.

> ## Use the analysis of SIEMs in part 1 and the identified indicators of the attack in part 2 to write Sigma rules to detect each of the three attacks from Assignment 1. Convert the rule into the SIEM logic for your chosen SIEM in Part 1

{: style="text-align: justify" }
This Sigma rule is designed to detect 404 responses triggered by invalid user IDs, aiding in the identification of Insecure Direct Object Reference (IDOR) attacks targeting the web application. The rule ID is a randomly generated UUID. The MITRE tag associated with this rule corresponds to the Initial Access -> User Accounts technique. The rule searches webserver access logs for URLs requested via the GET method that include the string ```profile?user=``` and result in an ```HTTP 404 response```.

IMAGE MISSING
IDOR Sigma rule.

{: style="text-align: justify" }
The following screenshot shows the translation of the Sigma rule into the Splunk Search Processing Language using the online ```uncoder.io``` encoder for encoding rules into other formats for rule integration in a number of different SIEM applications. Note it seems to be defaulting the log source to Windows Event logs, so this rule would need to be modified to include the correct IIS log path of ```source="C:\\inetpub\\logs\\LogFiles\\W3SVC1\\``` before it can be added to Splunk.

IMAGE MISSING
Translating the IDOR Sigma rule to SPL for importing into Splunk.

{: style="text-align: justify" }
The next Sigma rule is designed to detect Cross Site Scripting (XSS) attacks targeting the web application by searching any URL requested using the GET method for strings that can be used to run JavaScript. The rule ID is a randomly generated UUID. The MITRE tag associated with this rule corresponds to the Initial Access -> Drive-by Compromise technique. The rule searches webserver access logs for URLs requested via the GET method that include any of the strings ```<script>```, ```<img>``` or ```<iframe>```. The rule can be expanded to include other keywords.

IMAGE MISSING
XSS Sigma rule

{: style="text-align: justify" }
The next screenshot shows the XXS Sigma rule translated into Splunk Search Processing Language using the online uncoder.io encoder. Once again, the automatic encoder uses the incorrect log source of Windows Event logs, so this would need to be changed to use the Windows IIS logs and/or Apache access log.

IMAGE MISSING
Translating the XXS Sigma rule to SPL for importing into Splunk.

{: style="text-align: justify" }
The final Sigma rule is designed to detect Server-Side Request Forgery (SSRF) attacks. The rule works by searching the web access logs for URLs that may contain the host section of internal IP addresses or internal hostnames. The rule ID is a randomly generated UUID. The MITRE tag associated with this rule corresponds to the Lateral Movement -> Exploitation of Remote Services technique. The rule searches webserver access logs for URLs requested via the GET method that include any of the strings "http://10.0.0.", "http://172.16.", "http://192.168." or "http://internal-server". The rule can be expanded to include other IP ranges and hostnames.



SSRF Sigma rule.
The following screenshot shows the SSRF Sigma rule translated into Splunk Search Processing Language using the online uncoder.io encoder. The log source will need to be corrected to be “source="C:\\inetpub\\logs\\LogFiles\\W3SVC1\\” for monitoring Windows IIS servers or "/var/log/apache2/access.log" for monitoring Linux Apache servers before it can be added to Splunk.

 
Translating the SSRF Sigma rule to SPL for importing into Splunk.

Use the analysis of SIEMs in part 1 and the identified indicators of the attack in part 2 to write YARA rules to detect each of the three attacks from Assignment 1.

For each attack:
• Write the YARA Rule
• Provide an example showing that the rule is successful (use the yara tool and an example
file)
• Discuss what log data would be most suitable and would data from multiple
devices/sources be beneficial to the rule. If so, how would you implement multiple
sources in the rule.

The first Yara rule is crafted to identify Insecure Direct Object Reference (IDOR) attacks aimed at a web application. This rule is intended for use with web server logs, such as the Apache access.log file or files within the Windows IIS logging directory. It identifies any log line wherein the profile page is accessed with an invalid user ID, thus triggering on a 404 HTTP response code for profile page requests.

 
Yara rule for detecting IDOR in webserver logs.
 
The Yara rule triggering on an Apache access.log file.

The second YARA rule aims to identify Cross-Site Scripting (XSS) attacks against the web application by examining the webserver logs for URLs containing specific keywords commonly associated with Reflected XSS attacks. These keywords include script, img, and iframe which are not typically found in regular URLs.
 
Yara rule for detecting XXS in webserver logs.
 
The Yara rule triggering on an Apache access.log file.

Finally, we have the Yara rule for detecting a Server-Side Request Forgery (SSRF). This Yara rule will scan webserver logs and trigger if it detects a specified list of internal IP ranges or internal hostnames prepended with "http://".

 
Yara rule for detecting SSRF in webserver logs.
 
The Yara rule triggering on an Apache access.log file.

All three of these YARA rules are crafted to identify Indicators of Compromise (IoC) within the web server logs. However, relying solely on text-based logs may lead to a high number of false positives triggered by the YARA rules. To enhance detection accuracy, additional log data can be collected, such as behavioral analysis from Intrusion Detection and Prevention systems. This can help identify unusual traffic patterns or excessively frequent requests to the same page from the same IP address.

Part 3 - Network Packet Analysis using Logs

In this section of the assignment, we are given a packet capture (PCAP) from an Active Directory environment. The PCAP provides evidence of a system infected with an unknown malware. Additionally, the PCAP includes a Windows domain user account in the format firstname.lastname, which is linked to the infected system. Using Zui and Wireshark, our objective is to identify the IP address and hostname of the infected system, determine the username associated with it, pinpoint the date and time when the infection began, and ascertain the family of malware responsible.

We begin by opening the packet capture in Wireshark. We are interested in getting the IPv4 address of all endpoints conversing in the PCAP, so we navigate to Statistics -> Endpoints. Within the IPv4 tab, we arrange the addresses by sorting through the Address column. Upon reviewing the list, we identify four IP addresses within the 172.17.4.0/24 network.

 
The four 172.17.4.0/24 IPv4 addresses identified as endpoints.

The environment details provided to us are as follows:
LAN segment range: 172.17.4.0/24
• Domain: nutmeg-station.com
• Domain Controller: 172.17.4.4 - NutmegCrazy-DC
• LAN segment gateway: 172.17.4.1
• LAN segment broadcast address: 172.17.4.255

Therefore, we can concentrate our efforts on the IPv4 address 172.17.4.206. To narrow down our analysis, we filter the PCAP to display only packets with the source or destination IP of 172.17.4.206, using the Wireshark filter ip.addr==172.17.4.206. To inspect potentially significant content within these packets, we navigate to File -> Objects -> HTTP. Upon doing so, we immediately notice a suspicious object in the packet capture: an application downloaded from IP address 185.183.99.115. By clicking on the Save button, we extract this binary file for further examination.

 
A suspicious binary downloaded by 172.17.4.206 from 185.183.99.115.


The object is indicated to conclude at packet 2745. However, to view the entire sequence of events, we right-click on packet 2745 and select Follow -> HTTP Stream. Here, we see that the download started with packet 1499 on Tuesday, 4th May 2021, at 22:16:56 GMT. Based on the file's attributes such as the MZ magic number and the DOS stub string "This program must be run under Win32" it is identified as a Windows Portable Executable (PE) binary file; i.e., a Windows program.

 
Viewing the HTTP stream which contains the suspicious file download.

Upon extracting the binary, we use the xxd hexdump application on the command line to validate that this file named 44313,6048108796.dat is indeed a Windows PE binary. Next, using the md5sum application, we search for the file's MD5 hash online in VirusTotal and Joe's Sandbox to determine if it is a known malicious file. VirusTotal reveals that 58 out of 70 vendors classify this file hash as malicious. Furthermore, Joe's Sandbox identifies the file as a variant of the Qbot malware. QBot, also known as Qakbot, QuackBot, and Pinkslipbot, is a Banking Trojan first documented in 2007. Presently, it remains a significant threat to organizations globally, persisting as one of the leading Banking Trojans in circulation [https://www.datto.com/blog/qbot-malware-what-is-it-and-how-does-it-work/].

 
Confirming the file type using xxd hexdump on the command line.

 
Using md5sum to generate an MD5 digest (hash) of the file.
 Searching for the file hash on VirusTotal. It is recognised as a malicious application.

 
Searching for the file hash on Joe’s Sandbox. The file is recognised as the Qbot malware.

We have now identified that the system assigned the IP address 172.17.4.206 initiated the download of the Qbot banking trojan on Tuesday, 4th May 2021, at 22:16:56, marking the start of the system's infection. Next, we will utilize Zui, a tool which can parse capture files and allow the construction of search queries, facilitating the extraction of information from the PCAP with ease. Zui incorporates the Suricata threat detection engine, enabling us to determine if Suricata would have generated an alert for this malicious network traffic, thereby providing an early indication of the infection.

To confirm if Suricata would have triggered an alert for this network traffic, we utilize the "Suricata Alerts by Signature" search query sourced from the available list on the Brimcap GitHub page [https://github.com/brimdata/brimcap]. Our search confirms the detection of a malicious executable within the PCAP. 

 
Alerts that Suricata would have triggered if monitoring the network.

To gather further insights into this alert, we refine our search criteria to event_type=="alert" and focus on Severity 1 alerts. Upon examination, we observe that the download of the network trojan from IP address 185.183.99.115 to IP address 172.17.4.206 was indeed detected at timestamp 2021-05-04T22:16:53. This aligns precisely with the findings of our Wireshark analysis, confirming that Suricata would have issued an early warning about the infection had it been monitoring the network traffic.

 
The details of the Suricata Severity 1 alert for the download of the suspicious file.

To extract the filename of the downloaded malware using Zui, we execute a search for all GET requests using the search query method=="GET" | cut ts, uid, id, method, uri, status_code | sort. Upon examining the results, we identify the successful download of a file named 44313,6048108796.dat, initiated by IP address 172.17.4.206 and sourced from IP address 185.183.99.115, occurring at the timestamp under investigation.
 
Viewing the filename of the download at the time being investigated.

After matching our Wireshark discoveries with Zui searches, our next task is to determine the hostname and user account associated with the IP address 172.17.4.206. Given that this environment operates on a Windows Active Directory setup, it's likely that such details are embedded within Kerberos related network activities. Extracting this data from Wireshark could be complex, but Zui simplifies this process significantly. During parsing, Zui categorizes all relevant network activities under a _path field. To visualize these categorized events, we utilize a search query _path | count() by _path | sort -r to display the _path fields assigned by Zui, revealing 32 Kerberos related events within the network traffic.
 
The _path fields assigned by ZUI.

To specifically access details about Kerberos packets, we execute a simple search for _path=="kerberos". Checking the results, we easily match the IP address 172.17.4.206 with the hostname DESKTOP-V0FEH1L$ and the domain user account alfonso.paternoster.
 
Identifying the system hostname and user account associated with 172.17.4.206 from Kerberos related data.

We now have all the information we were looking for:

• IP address of the infected Windows computer: 172.17.4.206
• Host name of the infected Windows computer: DESKTOP-V0FEH1L$
• User account name on the infected Windows computer: alfonso.paternoster
• Date and time the infection activity began in UTC: Tuesday, 4th May 2021, at 22:16:56 GMT
• The family of malware involved: Qbot Banking Trojan
References:
[1]  What is SIEM?, (Accessed 1st May 2024) URL - https://www.microsoft.com/en-ie/security/business/security-101/what-is-siem 

[2]  Security Information And Event Management (SIEM), Apr 27, 2023, (Accessed 1st May 2024) URL - https://www.gartner.com/en/information-technology/glossary/security-information-and-event-management-siem 

[3]  What is log normalization?, (Accessed 1st May 2024) URL - https://www.manageengine.com/products/eventlog/logging-guide/log-normalization.html 

[4]  SIEM DONE RIGHT, Aug 16, 2022, (Accessed 1st May 2024) URL - https://graylog.org/products/security/ 

[5]  Single Pane of Glass Gives a Clear View of Security Operations, Nov 09, 2022, (Accessed 1st May 2024) URL - https://netenrich.com/blog/a-single-pane-of-glass-for-a-clear-view-of-security-operations 

[6]  What is a cybersecurity incident?, (Accessed 1st May 2024) URL - https://www.manageengine.com/log-management/siem/tracking-security-incidents.html 

[7]  What is event correlation?, (Accessed 1st May 2024) URL - https://www.manageengine.com/log-management/siem/static-dynamic-event-correlation.html 

[8]  Top Challenges in Implementing SIEM Solutions, Oct 24, 2023, (Accessed 1st May 2024) URL - https://www.logsign.com/blog/top-challenges-in-implementing-siem-solutions/

[9]  What Is Alert Fatigue?, Feb 03, 2023, (Accessed 1st May 2024) URL - https://www.proofpoint.com/uk/threat-reference/alert-fatigue

[10]  Understanding SIEM and Its Benefits for SMEs, Dec 18, 2023, (Accessed 1st May 2024) URL - https://help4it.co.uk/blog/understanding-siem-and-its-benefits-for-smes/

[11]  User behavior analytics with IBM Security QRadar SIEM, (Accessed 1st May 2024) URL - https://www.ibm.com/products/qradar-siem/user-behavior-analytics 

[12]  Top Metrics to manage your SIEM Program, Nov 27, 2019, (Accessed 1st May 2024) URL - https://www.cisoplatform.com/profiles/blogs/top-metrics-to-manage-your-siem-program 

[13]  What you should know about driving down MTTD and MTTR, Aug 16, 2018, (Accessed 1st May 2024) URL - https://chronicle.security/blog/posts/driving-down-mttd-and-mttr/

[14]  14 Cybersecurity Metrics + KPIs You Must Track in 2024, Jan 22, 2024, (Accessed 1st May 2024) URL - https://www.upguard.com/blog/cybersecurity-metrics 

[15]  SIEM Tools: Top 6 SIEM Platforms, Features, Use Cases and TCO, Jan 31, 2022,  (Accessed 1st May 2024) URL - https://www.exabeam.com/explainers/siem-tools/siem-buyers-guide/ 

[16]  What Is Netflow?, Mar 18, 2024, (Accessed 1st May 2024) URL - https://www.ninjaone.com/blog/what-is-netflow/ 
[17]  SIEM Tools: Top 6 SIEM Platforms, Features, Use Cases and TCO, Jan 31, 2022, (Accessed 1st May 2024) URL - https://www.exabeam.com/explainers/siem-tools/siem-buyers-guide/

[18]  SIEM VS LOG MANAGEMENT, Feb 10, 2023, (Accessed 1st May 2024) URL - https://www.crowdstrike.com/cybersecurity-101/observability/siem-vs-log-management/

[19]  SIEM VS IDS: What’s The Difference?, Mar 22, 2020, (Accessed 1st May 2024) URL - https://purplesec.us/siem-vs-ids/

[20]  Normalization, Jul 19, 2016, (Accessed 1st May 2024) URL - https://www.logpoint.com/en/blog/normalization/

[21]  SIEM Tools: Top 6 SIEM Platforms, Features, Use Cases and TCO, 31 Jan, 2022, (Accessed 1st May 2024) URL - https://www.exabeam.com/explainers/siem-tools/siem-buyers-guide/

[22]  Splunk Pricing Options, Jul 12, 2023, (Accessed 1st May 2024) URL - https://www.splunk.com/en_us/resources/splunk-pricing-options.html

[23]  What Is SOAR?, (Accessed 1st May 2024) URL - https://www.paloaltonetworks.com/cyberpedia/what-is-soar

[24]  What Is UEBA?, (Accessed 1st May 2024) URL - https://www.fortinet.com/resources/cyberglossary/what-is-ueba

[25]  AI SIEM: The 6 Components of AI-Based SIEM, Jan 09, 2024, (Accessed 1st May 2024) URL - https://stellarcyber.ai/learn/ai-driven-siem/

[26]  True cost of SIEM (Security Information and Event Management), Mar 06, 2018, (Accessed 1st May 2024) URL - https://foresite.com/blog/true-cost-siem-security-information-event-management/

[27]  SIEM Implementation in 4 Steps, May 13, 2023, (Accessed 1st May 2024) URL - https://www.exabeam.com/explainers/siem/siem-implementation-in-4-steps/

[28]  SIEM: A Guide to Successful Implementation, Strategy, and Planning, Mar 04, 2024, (Accessed 1st May 2024) URL - https://stackify.com/siem-implementation-strategy-and-plan/

[29]  8 SIEM Cost Factors You Need to Know, Jan 18, 2024, (Accessed 1st May 2024) URL - https://www.omeronsecurity.com/p/8-siem-cost-factors-you-need-to-know

[30]  Agent vs Agentless Log Collection, (Accessed 1st May 2024) URL - https://www.snaresolutions.com/wp-content/uploads/2020/03/Snare-Agents-vs-Agentless-1.pdf

[31]  Agentless vs Agent-Based Security, (Accessed 1st May 2024) URL - https://www.paloaltonetworks.com/cyberpedia/what-is-the-difference-between-agent-based-and-agentless-security-related

[32] Top Challenges in Implementing SIEM Solutions, Oct 24, 2023, (Accessed 1st May 2024) URL -  https://www.logsign.com/blog/top-challenges-in-implementing-siem-solutions

[33]  Why SIEMs Struggle to Monitor the Cloud, Nov 24, 2023, (Accessed 1st May 2024) URL - https://www.spiceworks.com/it-security/cloud-security/guest-article/why-siems-struggle-to-monitor-the-cloud/

[34]  Detecting Personally Identifiable Information (PII) in log data for GDPR compliance, May 25, 2022, (Accessed May 1, 2024)   URL - https://lantern.splunk.com/Security/UCE/Foundational_Visibility/Compliance/Detecting_Personally_Identifiable_Information_(PII)_in_log_data_for_GDPR_compliance 

[35]  Different types of logs in SIEM and their log formats, (Accessed May 1, 2024)  URL - https://www.manageengine.com/log-management/siem/collecting-and-analysing-different-log-types.html 

[36] WHAT IS LOG PARSING?, Dec 21, 2022, (Accessed May 1, 2024)  URL - https://www.crowdstrike.com/cybersecurity-101/observability/log-parsing/ 

[37] Understanding Threat Management: How SIEM Tools Empower Risk Mitigation, Oct 11, 2023, (Accessed May 1, 2024),  URL - https://www.aptosolutions.co.uk/blog/threat-management-siem-tools-risk-mitigation/ 

[38] Evolving Your SIEM Detection Rules: A Journey from Simple to Sophisticated, Jan 16, 2024, (Accessed May 1, 2024)  URL - https://www.databricks.com/blog/evolving-your-siem-detection-rules-journey-simple-sophisticated 

[39] What Is Threat Hunting?, (Accessed 1st May 2024)   URL - https://www.fortinet.com/resources/cyberglossary/threat-hunting

[40] What is Cyber Threat Hunting?, Jul 12, 2023, (Accessed 1st May 2024)   URL - https://securityscorecard.com/blog/what-is-cyber-threat-hunting/

[41] What Is Cyber Threat Hunting?, (Accessed 1st May 2024)   URL - https://www.trellix.com/security-awareness/operations/what-is-cyber-threat-hunting/

[42] How to Build a Proactive Threat Hunting Strategy, Apr 14, 2022, (Accessed 1st May 2024)   URL - https://www.iansresearch.com/resources/all-blogs/post/security-blog/2022/04/14/how-to-build-a-proactive-threat-hunting-strategy

[43] What Is Threat Hunting? Complete Guide, Sep 13, 2023, (Accessed 1st May 2024)   URL - https://www.exabeam.com/explainers/information-security/threat-hunting-tips-and-tools/

[44] What is Behavioral Analysis, (Accessed 1st May 2024)   URL - https://www.vmware.com/topics/glossary/content/behavioral-analysis.html

[45] Threat hunting converting SIGMA to YARA, Jun 26, 2023, (Accessed May 1, 2024)  URL - https://blog.virustotal.com/2023/06/threat-hunting-converting-sigma-to-yara.html

[46] What Are SIGMA Rules: Beginner’s Guide, May 16, 2022, (Accessed May 1, 2024)  URL - https://socprime.com/blog/sigma-rules-the-beginners-guide/

[47] What is YARA rules?, (Accessed May 1, 2024)  URL - https://netenrich.com/glossary/yara-rules

[48] 8 Best Threat Intelligence Feeds to Monitor in 2023, Jan 29, 2023, (Accessed May 1, 2024)  URL - https://cybeready.com/threat-intelligence/best-threat-intelligence-feeds-to-monitor-in-2023

[49] Information Sharing and Analysis Centers (ISACs), Feb 29, 2016, (Accessed May 1, 2024)  URL - https://www.enisa.europa.eu/topics/national-cyber-security-strategies/information-sharing

[50] ISACs: Information Sharing & Analysis Centers, Oct 18, 2023, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/blog/learn/isacs-information-sharing-analysis-centers.html

[51] How to Plan a Threat Hunt: Using Log Analytics to Manage Data in Depth, Jun 21, 2021, (Accessed May 1, 2024)  URL - https://www.dataversity.net/how-to-plan-a-threat-hunt-using-log-analytics-to-manage-data-in-depth/ 

[52] General Data Protection Regulation, Jul 13, 2016, (Accessed May 1, 2024)  URL - https://gdpr-info.eu/

[53] What are the 4 things that PCI DSS covers?, (Accessed May 1, 2024)  URL - https://www.6clicks.com/resources/answers/what-are-the-4-things-that-pci-dss-covers 

[54] Cisco Completes Acquisition of Splunk, Mar 18, 2024, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/newsroom/press-releases/2024/cisco-completes-acquisition-of-splunk.html 

[55] Splunk Enterprise Security, Apr 09, 2024, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/products/enterprise-security.html

[56] Splunk Enterprise Security Product Brief, May 02, 2023, (Accessed May 1, 2024)  URL -https://www.splunk.com/en_us/resources/splunk-enterprise-security.html

[57] Infrastructure Monitoring Today: How It Works & What It Does, Sep 26, 2023, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/blog/learn/infrastructure-monitoring.html

[58] Data & Database Normalization Explained: How To Normalize Data, Apr 18, 2024, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/blog/learn/data-normalization.html

[59] Pricing, Sep 28, 2023, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/products/pricing.html

[60] Workload Pricing, Sep 27, 2023, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/products/pricing/workload-pricing.html

[61] Ingest Pricing, Sep 27, 2023, (Accessed May 1, 2024)  URL - https://www.splunk.com/en_us/products/pricing/ingest-pricing.html

[62] Get Started with Splunk Community, (Accessed May 1, 2024)  URL - https://docs.splunk.com/Documentation/Community/current/community/Support

[63] About Sigma, (Accessed May 1, 2024)  URL - https://sigmahq.io/docs/guide/about.html

[64] Welcome to YARA's documentation!, (Accessed May 1, 2024)  URL - https://yara.readthedocs.io/en/stable/index.html

[65] Writing YARA rules, (Accessed May 1, 2024)  URL - https://yara.readthedocs.io/en/stable/writingrules.html
[66] UNCODER.IO, (Accessed May 1, 2024)  URL - https://uncoder.io/ 
